(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{YiP8:function(e,t,o){"use strict";o.r(t),o.d(t,"ScreenShareModule",function(){return l}),o.d(t,"ScreenShareComponent",function(){return d});var i=o("ikaO"),s=o("ofXK"),c=o("tyNb"),n=o("mrSG"),r=o("fXoL");const a=["canvas"],h=["video"];let d=(()=>{class e{constructor(e){this.mediaService=e,this.offerOptions={offerToReceiveAudio:!0,offerToReceiveVideo:!0},this.onSetLocalSuccess=e=>{console.log(this.getName(e)+" setLocalDescription complete")},this.onSetRemoteSuccess=e=>{console.log(this.getName(e)+" setRemoteDescription complete")},this.onSetSessionDescriptionError=e=>{console.log("Failed to set session description: "+e.toString())},this.gotRemoteStream=e=>{this.video.srcObject!==e.streams[0]&&(this.video.srcObject=e.streams[0],console.log("pc2 received remote stream"))},this.onCreateAnswerSuccess=e=>{console.log("Answer from pc2:\n"+e.sdp),console.log("pc2 setLocalDescription start"),this.pc2.setLocalDescription(e).then(()=>this.onSetLocalSuccess(this.pc2)).catch(this.onSetSessionDescriptionError),console.log("this.pc1 setRemoteDescription start"),this.pc1.setRemoteDescription(e).then(()=>this.onSetRemoteSuccess(this.pc1)).catch(this.onSetSessionDescriptionError)},this.onIceCandidate=(e,{candidate:t})=>{t&&this.getOtherPc(e).addIceCandidate(t).then(()=>this.onAddIceCandidateSuccess(e),t=>this.onAddIceCandidateError(e,t)),console.log(`${this.getName(e)} ICE candidate: ${t?t.candidate:"(null)"}`)},this.onAddIceCandidateSuccess=e=>{console.log(this.getName(e)+" addIceCandidate success")},this.onAddIceCandidateError=(e,t)=>{console.log(`${this.getName(e)} failed to add ICE Candidate: ${t.toString()}`)},this.onIceStateChange=(e,t)=>{e&&(console.log(`${this.getName(e)} ICE state: ${e.iceConnectionState}`),console.log("ICE state change event: ",t))},this.getName=e=>e===this.pc1?"pc1":"pc2",this.getOtherPc=e=>e===this.pc1?this.pc2:this.pc1}ngOnInit(){return Object(n.a)(this,void 0,void 0,function*(){})}onScreen(){return Object(n.a)(this,void 0,void 0,function*(){const e=yield this.mediaService.getDisplayMedia();console.log(e)})}ngAfterViewInit(){this.canvas=this.canvasRef.nativeElement,this.video=this.videoRef.nativeElement,this.video.addEventListener("loadedmetadata",function(){console.log(`Remote video videoWidth: ${this.videoWidth}px,  videoHeight: ${this.videoHeight}px`)}),this.video.onresize=()=>{if(console.log(`Remote video size changed to ${this.video.videoWidth}x${this.video.videoHeight}`),this.startTime){const e=window.performance.now()-this.startTime;console.log(`Setup time: ${e.toFixed(3)}ms`),this.startTime=null}}}call(){return Object(n.a)(this,void 0,void 0,function*(){console.log("Starting call"),this.startTime=window.performance.now();const e=yield this.mediaService.getDisplayMedia();this.mediaService.currentStream=e,console.log(e);const t=e.getVideoTracks(),o=e.getAudioTracks();t.length>0&&console.log("Using video device: "+t[0].label),o.length>0&&console.log("Using audio device: "+o[0].label);const i={iceServers:[{urls:"stun:stun.stunprotocol.org:3478"}]};this.pc1=new RTCPeerConnection(i),console.log("Created local peer connection object pc1"),this.pc1.onicecandidate=e=>this.onIceCandidate(this.pc1,e),this.pc2=new RTCPeerConnection(i),console.log("Created remote peer connection object this.pc2"),this.pc2.onicecandidate=e=>this.onIceCandidate(this.pc2,e),this.pc1.oniceconnectionstatechange=e=>this.onIceStateChange(this.pc1,e),this.pc2.oniceconnectionstatechange=e=>this.onIceStateChange(this.pc2,e),this.pc2.ontrack=this.gotRemoteStream,this.mediaService.currentStream.getTracks().forEach(e=>{this.pc1.addTrack(e,this.mediaService.currentStream)}),console.log("Added local stream to pc1"),console.log("pc1 createOffer start"),this.pc1.createOffer(this.offerOptions).then(e=>this.onCreateOfferSuccess(e)).catch(e=>this.onCreateSessionDescriptionError(e))})}onCreateSessionDescriptionError(e){console.log("Failed to create session description: "+e.toString())}onCreateOfferSuccess(e){console.log("Offer from pc1\n"+e.sdp),console.log("pc1 setLocalDescription start"),this.pc1.setLocalDescription(e).then(()=>this.onSetLocalSuccess(this.pc1),this.onSetSessionDescriptionError),console.log("pc2 setRemoteDescription start"),this.pc2.setRemoteDescription(e).then(()=>this.onSetRemoteSuccess(this.pc2),this.onSetSessionDescriptionError),console.log("pc2 createAnswer start"),this.pc2.createAnswer().then(e=>this.onCreateAnswerSuccess(e)).catch(this.onCreateSessionDescriptionError)}}return e.\u0275fac=function(t){return new(t||e)(r.Lb(i.b))},e.\u0275cmp=r.Fb({type:e,selectors:[["quertc-screen-share"]],viewQuery:function(e,t){if(1&e&&(r.Dc(a,!0),r.Dc(h,!0)),2&e){let e;r.lc(e=r.Zb())&&(t.canvasRef=e.first),r.lc(e=r.Zb())&&(t.videoRef=e.first)}},decls:8,vars:0,consts:[[3,"click"],["canvas",""],["playsinline","","autoplay","","muted",""],["video",""]],template:function(e,t){1&e&&(r.Rb(0,"p"),r.Ac(1,"screen-share works!"),r.Qb(),r.Rb(2,"button",0),r.Yb("click",function(){return t.call()}),r.Ac(3,"Ligar"),r.Qb(),r.Mb(4,"canvas",null,1),r.Mb(6,"video",2,3))},styles:[""]}),e})(),l=(()=>{class e{}return e.\u0275mod=r.Jb({type:e}),e.\u0275inj=r.Ib({factory:function(t){return new(t||e)},imports:[[s.c,i.c,c.d.forChild([{path:"",pathMatch:"full",component:d}])]]}),e})()}}]);